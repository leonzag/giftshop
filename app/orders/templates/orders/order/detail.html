{% extends "base.html" %}

{% block title %}
    Детали заказа {{ order.id }}
{% endblock %}

{% block sidebar %}
    {% include "orders_sidebar.html" %}
{% endblock sidebar %}

{% block content %}
    <h1 class="text-3xl font-bold mb-6 text-gray-800">Детали заказа №{{ order.id }}</h1>

    <div class="bg-white shadow-md rounded-lg p-6 mb-8">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Информация о заказе</h2>
        <p><strong>Дата заказа:</strong> {{ order.created|date:"d.m.Y H:i" }}</p>
        <p><strong>Статус оплаты:</strong>
            {% if order.paid %}
                <span class="text-green-600 font-medium">Оплачен</span>
            {% else %}
                <span class="text-red-600 font-medium">Не оплачен</span>
            {% endif %}
        </p>
        <p><strong>Имя:</strong> {{ order.first_name }} {{ order.last_name }}</p>
        <p><strong>Email:</strong> {{ order.email }}</p>
        <p><strong>Телефон:</strong> {{ order.phone_number }}</p>
        <p><strong>Адрес:</strong> {{ order.address }}, {{ order.postal_code }}, {{ order.city }}</p>
        {% if order.coupon %}
            <p><strong>Применен купон:</strong> {{ order.coupon.code }} (скидка {{ order.discount }}%)</p>
        {% endif %}
    </div>

    <div class="bg-white shadow-md rounded-lg p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Товары в заказе</h2>
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Товар
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Цена
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Количество
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Стоимость
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for item in order.items.all %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            {{ item.product.name }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ item.price }} {{ order.get_currency_display }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ item.quantity }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ item.get_cost }} {{ order.get_currency_display }}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr class="bg-gray-50">
                    <th colspan="3" class="px-6 py-3 text-right text-base font-medium text-gray-700">
                        Общая стоимость:
                    </th>
                    <th class="px-6 py-3 text-left text-base font-medium text-indigo-600">
                        {{ order.get_total_cost }} {{ order.get_currency_display }}
                    </th>
                </tr>
            </tfoot>
        </table>
    </div>
    <p class="mt-8 text-center">
        <a href="{% url 'orders:order_history' %}" class="text-indigo-600 hover:text-indigo-800 font-medium">
            &larr; Назад к истории заказов
        </a>
    </p>
{% endblock %}
